var mysql = require('mysql')
  ,async = require('async')

var pool = mysql.createPool({
  host: 'localhost',
  user:'root'
  database: 'keepfocusserverdb'
  supportBigNumbers: true
});
//get records from table
exports.getRecords = function(data, callback){
  var tableName = Object.keys(data.tables)
  async.each(tableName, function(name,cb){
    async.each(data.tables[name],function(row,cb){
      var keys = Object.keys(row),
      values = keys.map(function(key){
        return "'" + row[key] + "'"
      });
      var sql = "SELECT " + name + "FROM " + tableName;
      //get a connection from the pool
      pool.getConnection(function(err, connection){
        if(err) {
          console.log(err);
          callback(true);
          return;
        }
        //make a query
        connection.query(sql,function(err,results){
          connection.release();
          if(err){
            console.log(err);
            callback(true);
            return;
          }
          callback(false,results);
        });
      });
    });
  });
};

//check connection
exports.connect = function(err){
  if(err){
    console.log(err);
    return;
  }
  console.log("connecting to db...");
}
